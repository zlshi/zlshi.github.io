<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Java Reflection," />










<meta name="description" content="参考自jenkov java-reflection Classes使用Java反射，可以在运行时检查Java类。在使用Reflection时，可以从Classes获取以下信息：  Class Name Class Modifies(public,private,synchronized etc.) Package Info Superclass Implemented Interfaces Con">
<meta name="keywords" content="Java Reflection">
<meta property="og:type" content="article">
<meta property="og:title" content="Java反射">
<meta property="og:url" content="http://www.iaihe.cn/blog/2017/11/21/Java反射/index.html">
<meta property="og:site_name" content="MarginStone&#39;s blog">
<meta property="og:description" content="参考自jenkov java-reflection Classes使用Java反射，可以在运行时检查Java类。在使用Reflection时，可以从Classes获取以下信息：  Class Name Class Modifies(public,private,synchronized etc.) Package Info Superclass Implemented Interfaces Con">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://www.iaihe.cn/blog/images/MyAnnotation.png">
<meta property="og:image" content="http://www.iaihe.cn/blog/images/TheClassResult.png">
<meta property="og:image" content="http://www.iaihe.cn/blog/images/GenericReturnTypeOfMyClass.png">
<meta property="og:updated_time" content="2017-11-24T12:43:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java反射">
<meta name="twitter:description" content="参考自jenkov java-reflection Classes使用Java反射，可以在运行时检查Java类。在使用Reflection时，可以从Classes获取以下信息：  Class Name Class Modifies(public,private,synchronized etc.) Package Info Superclass Implemented Interfaces Con">
<meta name="twitter:image" content="http://www.iaihe.cn/blog/images/MyAnnotation.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.iaihe.cn/blog/2017/11/21/Java反射/"/>





  <title>Java反射 | MarginStone's blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b6e32040595c97e2ab9b9ab86d76040c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MarginStone's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录点滴-旺仔&AD钙</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/blog/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blog/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-阅读">
          <a href="/blog/reading/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            阅读
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.iaihe.cn/blog/blog/2017/11/21/Java反射/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zlshi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MarginStone's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java反射</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-21T17:10:08+08:00">
                2017-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Java基础/" itemprop="url" rel="index">
                    <span itemprop="name">Java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>参考自<a href="http://tutorials.jenkov.com/java-reflection/classes.html" target="_blank" rel="external">jenkov java-reflection</a></p>
<h1 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h1><p>使用Java反射，可以在运行时检查Java类。在使用Reflection时，可以从Classes获取以下信息：</p>
<ul>
<li><strong>Class Name</strong></li>
<li><strong>Class Modifies(public,private,synchronized etc.)</strong></li>
<li><strong>Package Info</strong></li>
<li><strong>Superclass</strong></li>
<li><strong>Implemented Interfaces</strong></li>
<li><strong>Constructors</strong></li>
<li><strong>Methods</strong></li>
<li><strong>Fields</strong></li>
<li><strong>Anonotations</strong></li>
</ul>
<p>更具体的API列表参见<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html" title="java.lang.Class" target="_blank" rel="external">JavaDoc</a></p>
<h2 id="The-Class-Object"><a href="#The-Class-Object" class="headerlink" title="The Class Object"></a>The Class Object</h2><p>Java中所有类型（包括int,long,float等原始类型、数组）均有相关的Class对象，如果你在编译阶段知道某个类的名字，则可以使用如下方法获得这个Class对象：<br><figure class="highlight cos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> myObjectClass = MyObject.<span class="keyword">class</span></div></pre></td></tr></table></figure></p>
<p>如果在编译阶段不知道类的名字，但在运行阶段有类的名字，可以使用如下方法得到Class对象:<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">String</span> className = ...<span class="comment">//obtain class name as string at runtime</span></div><div class="line"><span class="keyword">Class</span> <span class="keyword">class</span> = <span class="keyword">Class</span>.forName(className)</div></pre></td></tr></table></figure></p>
<p>当使用Class.forName()方法的时候，必须提供全路径的类名（包括包名），此方法在classpath下找不到指定的类时，会抛出ClassNotFoundException异常。</p>
<h2 id="Class-Name"><a href="#Class-Name" class="headerlink" title="Class Name"></a>Class Name</h2><p>从Class对象中获取其名字有两种方法，分别是getName()和getSimpleName()，其中getName()方法包括包名，getSimpleName()没有包名。<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> aClass = ... <span class="comment">//obtain Class object. see The Class Object section</span></div><div class="line"><span class="keyword">String</span> className = aClass.getName();</div><div class="line"><span class="keyword">String</span> simpleClassName = aClass.getSimpleName();</div></pre></td></tr></table></figure></p>
<h2 id="Modifiers"><a href="#Modifiers" class="headerlink" title="Modifiers"></a>Modifiers</h2><p>使用Class对象可以知道类的public private static等信息。<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Class aClass = ...<span class="comment">//obtain Class object. See prev. section</span></div><div class="line"><span class="keyword">int</span> modifiers = aClass.<span class="built_in">getModifiers</span>();</div></pre></td></tr></table></figure></p>
<p>信息被存储在返回的int型modifier中的二进制位上，使用java.lang.reflect.Modifier提供的方法来测试。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Modifier.isAbstract(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isFinal(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isInterface(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isNative(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isPrivate(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isProtected(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isPublic(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isStatic(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isStrict(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isSynchronized(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isTransient(<span class="keyword">int</span> modifiers)</div><div class="line">Modifier.isVolatile(<span class="keyword">int</span> modifiers)</div></pre></td></tr></table></figure></p>
<h2 id="Package-Info"><a href="#Package-Info" class="headerlink" title="Package Info"></a>Package Info</h2><p>使用Class对象也可以获得包信息：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span>  aClass = ... <span class="comment">//obtain Class object. See prev. section</span></div><div class="line"><span class="keyword">Package</span> <span class="keyword">package</span> = aClass.getPackage();</div></pre></td></tr></table></figure></p>
<p>可以使用Package对象获得包的相关信息，具体参看<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Package.html" target="_blank" rel="external">java.lang.package</a></p>
<h2 id="Superclass"><a href="#Superclass" class="headerlink" title="Superclass"></a>Superclass</h2><p>获得当前Class对象的Superclass对象的方法如下：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Class superclass</span> = aClass.getSuperclass();</div></pre></td></tr></table></figure></p>
<h2 id="Implemented-Interfaces"><a href="#Implemented-Interfaces" class="headerlink" title="Implemented Interfaces"></a>Implemented Interfaces</h2><p>得到类实现的接口列表的方法如下：<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">Class</span>  <span class="title">aClass</span> = ... //<span class="title">obtain</span> <span class="title">Class</span> <span class="title">object</span>. <span class="title">See</span> <span class="title">prev</span>. <span class="title">section</span></span></div><div class="line"><span class="class"><span class="keyword">Class</span>[] <span class="title">interfaces</span> = <span class="title">aClass</span>.<span class="title">getInterfaces</span>();</span></div></pre></td></tr></table></figure></p>
<p>会返回当前类中声明实现的接口列表，对于父类中实现的接口而在子类中未声明实现，则不会返回到接口列表中，如果要获得当前类实现的所有接口列表需要递归父类的接口列表进行合并。</p>
<h2 id="Constructors"><a href="#Constructors" class="headerlink" title="Constructors"></a>Constructors</h2><p>获得构造器的方法如下：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Constructor</span>[] <span class="title">constructors</span> = <span class="title">aClass</span>.<span class="title">getConstructors</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure></p>
<p>对构造器的说明将在下面章节中更详细的介绍。</p>
<h2 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h2><p>获得方法列表的方法如下：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Method</span>[] <span class="title">method</span> = <span class="title">aClass</span>.<span class="title">getMethods</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure></p>
<p>更详细的说明见下面Methods章节。</p>
<h2 id="Fields"><a href="#Fields" class="headerlink" title="Fields"></a>Fields</h2><p>获得域列表的方法如下：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Field[] <span class="function"><span class="keyword">method</span> = <span class="title">aClass</span>.<span class="title">getFields</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure></p>
<p>更详细的说明见下面Fields章节。</p>
<h2 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h2><p>获得注解列表的方法如下：<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Annotation[] annotations = aClass.getAnnotations()<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>更详细的说明见下面Annotations章节。</p>
<h1 id="Constructors-1"><a href="#Constructors-1" class="headerlink" title="Constructors"></a>Constructors</h1><h2 id="Obtaining-Constructor-Objects"><a href="#Obtaining-Constructor-Objects" class="headerlink" title="Obtaining Constructor Objects"></a>Obtaining Constructor Objects</h2><p>使用Class对象可以得到Constructor对象：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> aClass = ...<span class="comment">//obtain class object</span></div><div class="line"><span class="function"><span class="keyword">Constructor</span>[] <span class="title">constructors</span> = <span class="title">aClass</span>.<span class="title">getConstructors</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure></p>
<p>会返回类中所有声明的public构造器，如果已知构造i器的参数个数和类型，则可以获得具体的构造器。比如：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> aClass = ...<span class="comment">//obtain class object</span></div><div class="line"><span class="function"><span class="keyword">Constructor</span> <span class="title">constructor</span> = <span class="title">aClass</span>.<span class="title">getConstructor</span><span class="params">(<span class="keyword">new</span> <span class="keyword">Class</span>[]&#123;String.<span class="keyword">class</span>&#125;)</span>;</span></div></pre></td></tr></table></figure></p>
<p>如果没有匹配参数的构造器，则会抛出NoSuchMethodException异常。</p>
<h2 id="Constructor-Parameters"><a href="#Constructor-Parameters" class="headerlink" title="Constructor Parameters"></a>Constructor Parameters</h2><p>通过getParameterTypes()方法得到Constructor的参数列表：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Constructor</span> <span class="title">constructor</span> = ...<span class="comment">// obtain constructor -see above</span></span></div><div class="line"><span class="function"><span class="title">Class</span> [] <span class="title">parameterTypes</span> = <span class="title">constructor</span>.<span class="title">getParameterTypes</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure></p>
<h2 id="Instantiating-Objects-using-Constructor-Object"><a href="#Instantiating-Objects-using-Constructor-Object" class="headerlink" title="Instantiating Objects using Constructor Object"></a>Instantiating Objects using Constructor Object</h2><p>使用Constructor初始化对象:<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//get constructor that takes a String as argument</span></div><div class="line"><span class="function"><span class="keyword">Constructor</span> <span class="title">constructor</span> = <span class="title">MyObject</span>.<span class="title">class</span>.<span class="title">getConstructor</span><span class="params">(<span class="keyword">String</span>.<span class="keyword">class</span>)</span>;</span></div><div class="line"></div><div class="line">MyObject myObject = (MyObject) <span class="function"><span class="keyword">constructor</span>.<span class="title">newInstance</span><span class="params">("<span class="keyword">constructor</span>-arg1")</span>;</span></div></pre></td></tr></table></figure></p>
<p>Constructor.newInstance()方法根据指定的参数创建对象。</p>
<h1 id="Fields-1"><a href="#Fields-1" class="headerlink" title="Fields"></a>Fields</h1><p>使用Java反射你可以在运行时得到类的成员变量并进行get/set。</p>
<h2 id="Obtaining-Field-Objects"><a href="#Obtaining-Field-Objects" class="headerlink" title="Obtaining Field Objects"></a>Obtaining Field Objects</h2><figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">Class</span> <span class="title">aClass</span> = ...//<span class="title">obtain</span> <span class="title">class</span> <span class="title">object</span></span></div><div class="line"><span class="keyword">Field</span>[] fields = aClass.getFields();</div></pre></td></tr></table></figure>
<p>返回的Field[]数组包含类中所有的public成员变量。</p>
<p>如果知道成员变量的名字，则可以使用getField()和getDeclaredField()方法获得成员变量对象。<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">Class</span> <span class="title">aClass</span> = <span class="title">MyObject</span>.<span class="title">class</span></span></div><div class="line"><span class="keyword">Field</span> <span class="keyword">field</span> = aClass.getField(<span class="string">"someField"</span>);</div><div class="line"><span class="keyword">Field</span> otherField = aClass.getDeclaredField(<span class="string">"someField"</span>)</div></pre></td></tr></table></figure></p>
<p>如果没有指定名字的成员变量会抛出NoSuchFieldException异常。<br>getField(String name)与getDeclaredField(String name)的区别是getField只能返回public的成员变量，而getDeclaredField还可以返回private修饰的成员变量。</p>
<h2 id="Field-Name"><a href="#Field-Name" class="headerlink" title="Field Name"></a>Field Name</h2><p>使用Field对象获得成员变量名字的方法如下：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">Field</span> <span class="meta">field</span> = ...//obtain <span class="meta">field</span> object</div><div class="line"><span class="keyword">String </span>fieldName = <span class="meta">field</span>.getName()<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<h2 id="Field-Type"><a href="#Field-Type" class="headerlink" title="Field Type"></a>Field Type</h2><p>得到成员变量类型的方法如下：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Field field</span> = aClass.getField(<span class="string">"someField"</span>);</div><div class="line"><span class="attribute">Object fieldType</span> = field.getType();</div></pre></td></tr></table></figure></p>
<h2 id="Getting-and-Setting-Field-Values"><a href="#Getting-and-Setting-Field-Values" class="headerlink" title="Getting and Setting Field Values"></a>Getting and Setting Field Values</h2><p>当我们得到Field对象时，就可以使用Field.get()和Field.set()方法来获得和设置成员变量的值。<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">Class</span> <span class="title">aClass</span> = <span class="title">MyObject</span>.<span class="title">class</span></span></div><div class="line"><span class="keyword">Field</span> <span class="keyword">field</span> = aClass.getField(<span class="string">"someField"</span>);</div><div class="line"></div><div class="line">MyObject objectInstance = <span class="keyword">new</span> MyObject();</div><div class="line">Object value = <span class="keyword">field</span>.get(objectInstance);</div><div class="line"><span class="keyword">field</span>.set(objectInstance,value);</div></pre></td></tr></table></figure></p>
<p>如果是一个static的成员，则Field的get和set方法传null作为参数。</p>
<h1 id="Methods-1"><a href="#Methods-1" class="headerlink" title="Methods"></a>Methods</h1><h2 id="Obtaining-Method-Objects"><a href="#Obtaining-Method-Objects" class="headerlink" title="Obtaining Method Objects"></a>Obtaining Method Objects</h2><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> aClass = ...<span class="comment">//obtain class object</span></div><div class="line"><span class="function"><span class="keyword">Method</span>[] <span class="title">methods</span> = <span class="title">aClass</span>.<span class="title">getMethods</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure>
<p>返回类中定义的public方法列表。<br>如果知道方法的名字和参数列表，则可以使用getMethod()直接得到Method对象。<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span>  aClass = ...<span class="comment">//obtain class object</span></div><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> =</span></div><div class="line"><span class="function">    <span class="title">aClass</span>.<span class="title">getMethod</span><span class="params">("doSomething", <span class="keyword">new</span> <span class="keyword">Class</span>[]&#123;String.<span class="keyword">class</span>&#125;)</span>;</span></div></pre></td></tr></table></figure></p>
<p>如果没有找到则会抛出NoSuchMethodException异常。<br>如果方法没有参数，则传递null<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span>  aClass = ...<span class="comment">//obtain class object</span></div><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> =</span></div><div class="line"><span class="function">    <span class="title">aClass</span>.<span class="title">getMethod</span><span class="params">("doSomething", null)</span>;</span></div></pre></td></tr></table></figure></p>
<h2 id="Method-Parameters-and-Return-Types"><a href="#Method-Parameters-and-Return-Types" class="headerlink" title="Method Parameters and Return Types"></a>Method Parameters and Return Types</h2><p>通过Method对象获得方法的参数列表<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> = ... // <span class="title">obtain</span> <span class="title">method</span> - <span class="title">see</span> <span class="title">above</span></span></div><div class="line"><span class="function"><span class="title">Class</span>[] <span class="title">parameterTypes</span> = <span class="title">method</span>.<span class="title">getParameterTypes</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure></p>
<p>得到返回类型：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> = ... // <span class="title">obtain</span> <span class="title">method</span> - <span class="title">see</span> <span class="title">above</span></span></div><div class="line"><span class="function"><span class="title">Class</span> <span class="title">returnType</span> = <span class="title">method</span>.<span class="title">getReturnType</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure></p>
<h2 id="Invoking-Methods-using-Method-Object"><a href="#Invoking-Methods-using-Method-Object" class="headerlink" title="Invoking Methods using Method Object"></a>Invoking Methods using Method Object</h2><p>使用Method对象调用类想对应的方法。<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//get method that takes a String as argument</span></div><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> = <span class="title">MyObject</span>.<span class="title">class</span>.<span class="title">getMethod</span><span class="params">("doSomething", String.<span class="keyword">class</span>)</span>;</span></div><div class="line">MyObject instance = <span class="keyword">new</span> MyObject();</div><div class="line">Object returnType = <span class="function"><span class="keyword">method</span>.<span class="title">invoke</span><span class="params">(instance,"parameter-value1")</span></span></div></pre></td></tr></table></figure></p>
<p>method.invoke的第一个参数为需要在哪个实例上调用的method方法的对象，弱如果是static修饰的方法则此参数传递null即可。</p>
<h1 id="Getters-and-Setters"><a href="#Getters-and-Setters" class="headerlink" title="Getters and Setters"></a>Getters and Setters</h1><p>Java反射无法直接得到类的Getter和Setter方法，但可以通过遍历Method[]数组，根据Getter和Setter方法的特征得到。具体特征约定如下：</p>
<ul>
<li><p><strong>Getter</strong><br>0参数，并且方法名以get开头。</p>
</li>
<li><p><strong>Setter</strong><br>1个参数，并且方法名以set开头。</p>
</li>
</ul>
<p>下面是实现举例：<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> static void printGettersSetters(<span class="class"><span class="keyword">Class</span> <span class="title">aClass</span>)&#123;</span></div><div class="line">	<span class="function"><span class="keyword">Method</span>[] <span class="title">methods</span> =</span> aClass.getMethods();</div><div class="line">	<span class="keyword">for</span>(<span class="function"><span class="keyword">Method</span> <span class="title">method</span>:</span> methods)&#123;</div><div class="line">		<span class="keyword">if</span>(isGetter(<span class="function"><span class="keyword">method</span>)) <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(</span><span class="string">"getter: "</span>+<span class="function"><span class="keyword">method</span>);</span></div><div class="line">		<span class="keyword">if</span>(isSetter(<span class="function"><span class="keyword">method</span>)) <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(</span><span class="string">"setter: "</span>+<span class="function"><span class="keyword">method</span>);</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> static boolean isGetter(<span class="function"><span class="keyword">Method</span> <span class="title">method</span>)&#123;</span></div><div class="line">	<span class="keyword">if</span>(!<span class="function"><span class="keyword">method</span>.<span class="title">getName</span>.<span class="title">startsWith</span>(</span><span class="string">"get"</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	<span class="keyword">if</span>(<span class="function"><span class="keyword">method</span>.<span class="title">getParameterTypes</span>(</span>).length !=<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	<span class="keyword">if</span>(void.class.equals(<span class="function"><span class="keyword">method</span>.<span class="title">getReturnType</span>(</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> static boolean isSetter(<span class="function"><span class="keyword">Method</span> <span class="title">method</span>)&#123;</span></div><div class="line">	<span class="keyword">if</span>(!<span class="function"><span class="keyword">method</span>.<span class="title">getName</span>(</span>).startsWith(<span class="string">"set"</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	<span class="keyword">if</span>(<span class="function"><span class="keyword">method</span>.<span class="title">getParameterTypes</span>(</span>).length != <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Private-Fields-and-Methods"><a href="#Private-Fields-and-Methods" class="headerlink" title="Private Fields and Methods"></a>Private Fields and Methods</h1><h2 id="Accessing-Private-Fields"><a href="#Accessing-Private-Fields" class="headerlink" title="Accessing Private Fields"></a>Accessing Private Fields</h2><p>访问private field需要使用Class.getDeclaredField(String name)或者Class.getDeclaredFields()方法。Class.getField(String name)和Class.getFields()方法只会返回公有域public field。<br>例如：<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrivateObject</span></span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> privateString = <span class="literal">null</span>;</div><div class="line">	<span class="keyword">public</span> PrivateObject(<span class="keyword">String</span> privateString)&#123;</div><div class="line">		<span class="built_in">this</span>.privateString = privateString;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">PrivateObject privateObject = <span class="keyword">new</span> PrivateObject(<span class="string">"The Private Value"</span>);</div><div class="line"></div><div class="line">Field privateStringField = PrivateObject.<span class="keyword">class</span>.getDeclaredField(<span class="string">"privateString"</span>);</div><div class="line"></div><div class="line">privateStringField.setAccessible(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="built_in">String</span> fieldValue = (<span class="built_in">String</span>) privateStringField.<span class="keyword">get</span>(privateObject);</div><div class="line">System.out.println(<span class="string">"fieldValue = "</span> + fieldValue); <span class="comment">//will print "The Private Value"</span></div></pre></td></tr></table></figure>
<h2 id="Accessing-Private-Methods"><a href="#Accessing-Private-Methods" class="headerlink" title="Accessing Private Methods"></a>Accessing Private Methods</h2><p>访问private method使用Class.getDeclaredMethod(String name, Class[] parameterTypes) 或者Class.getDeclaredMethods()<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrivateObject</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">String</span> privateString = <span class="literal">null</span>;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> PrivateObject(<span class="keyword">String</span> privateString) &#123;</div><div class="line">    <span class="built_in">this</span>.privateString = privateString;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">String</span> getPrivateString()&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.privateString;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">PrivateObject privateObject = <span class="keyword">new</span> PrivateObject(<span class="string">"The Private Value"</span>);</div><div class="line"></div><div class="line">Method privateStringMethod = PrivateObject.<span class="keyword">class</span>.</div><div class="line">        getDeclaredMethod(<span class="string">"getPrivateString"</span>, <span class="keyword">null</span>);</div><div class="line"></div><div class="line">privateStringMethod.setAccessible(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="built_in">String</span> returnValue = (<span class="built_in">String</span>)</div><div class="line">        privateStringMethod.invoke(privateObject, <span class="keyword">null</span>);</div><div class="line"></div><div class="line">System.out.println(<span class="string">"returnValue = "</span> + returnValue); <span class="comment">//will print "The Private Value"</span></div></pre></td></tr></table></figure>
<h1 id="Annotations-1"><a href="#Annotations-1" class="headerlink" title="Annotations"></a>Annotations</h1><h2 id="What-are-Java-Annotations"><a href="#What-are-Java-Annotations" class="headerlink" title="What are Java Annotations?"></a>What are Java Annotations?</h2><p>Annotation是一种在Java代码中插入的注释或元数据，这些注释可以在编译时通过预编译工具进行处理，也可以在运行时通过反射进行处理。<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MyAnnotation(name=<span class="meta-string">"someName"</span>, value =<span class="meta-string">"Hello World"</span>)</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TheClass</span></span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>TheClass类具有@MyAnnotation的注释，注释像接口一样定义。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="variable">@Target</span>(ElementType.TYPE)</div><div class="line"></div><div class="line">public <span class="variable">@interface</span> MyAnnotation&#123;</div><div class="line">	<span class="selector-tag">public</span> <span class="selector-tag">String</span> <span class="selector-tag">name</span>();</div><div class="line">	<span class="selector-tag">public</span> <span class="selector-tag">String</span> <span class="selector-tag">value</span>();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>interface前的@表明是定义Annotation<br>@Retention(RetentionPolicy.RUNTIME)表示注释在运行时可以通过反射来访问，如果没有指定，则注释在运行时不会保留。<br>@Target(ElementType.TYPE)表示注释只能用于类型（类和接口）的顶部，也可以指定用于方法和成员变量。</p>
<h3 id="Java-Annotations-Purposes"><a href="#Java-Annotations-Purposes" class="headerlink" title="Java Annotations Purposes"></a>Java Annotations Purposes</h3><p>Java注解用于以下目的:</p>
<ul>
<li>Compiler instructions</li>
<li>Build-time instructions</li>
<li>Runtime instructions</li>
</ul>
<h3 id="Annotation-Basics"><a href="#Annotation-Basics" class="headerlink" title="Annotation Basics"></a>Annotation Basics</h3><p>一个简单的注解如下所示：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Entity</span></div></pre></td></tr></table></figure></p>
<p>@告诉编译器这是一个注解，@之后为注解的名字，这里为Entity</p>
<h4 id="Annotation-Elements"><a href="#Annotation-Elements" class="headerlink" title="Annotation Elements"></a>Annotation Elements</h4><p>注解可以包含可以为其设置值的元素，元素就像一个属性或参数。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">Entity</span>(<span class="keyword">tableName</span> = <span class="string">"vehicles"</span>)</div></pre></td></tr></table></figure></p>
<p>在上面的例子中包含了一个名为tableName的元素，并且设置其值为vehicles。元素需要被括号包在其中，如果注解没有元素，则不需要后面的括号。</p>
<p>一个注解可以包含多个元素<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">Entity</span>(<span class="keyword">tableName</span>="<span class="keyword">vehicles</span>", primaryKey=<span class="string">"id"</span>)</div></pre></td></tr></table></figure></p>
<p>如果一个注解只包含一个元素，则可以将其命名为value<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">InsertNew</span>(<span class="keyword">value</span>="<span class="keyword">yes</span>")</div></pre></td></tr></table></figure></p>
<p>如果一个注解只包含一个名为value的元素，则可以省略名字<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@InsertNew(<span class="meta-string">"yes"</span>)</span></div></pre></td></tr></table></figure></p>
<h3 id="Annotation-Placement"><a href="#Annotation-Placement" class="headerlink" title="Annotation Placement"></a>Annotation Placement</h3><p>注解可以放在classes、interfaces、methods、methods parameters、fields and local variables。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Entity</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span>&#123;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>表示在类上的一个名为Entity的注解。<br>下面为在class fields methods parameters and local variables上的注解<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// class</span></div><div class="line"><span class="meta">@Entity</span> </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</div><div class="line">	<span class="comment">// field</span></div><div class="line">    <span class="meta">@Persistent</span> </div><div class="line">    <span class="keyword">protected</span> String vehicleName = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="comment">//method</span></div><div class="line">    <span class="meta">@Getter</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getVehicleName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.vehicleName;</div><div class="line">    &#125;</div><div class="line">	<span class="comment">//method parameter</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVehicleName</span><span class="params">(@Optional vehicleName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.vehicleName = vehicleName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">addVehicleNameToList</span><span class="params">(List names)</span> </span>&#123;</div><div class="line">	<span class="comment">// local variable</span></div><div class="line">        <span class="meta">@Optional</span></div><div class="line">        List localNames = names;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(localNames == <span class="keyword">null</span>) &#123;</div><div class="line">            localNames = <span class="keyword">new</span> ArrayList();</div><div class="line">        &#125;</div><div class="line">        localNames.add(getVehicleName());</div><div class="line"></div><div class="line">        <span class="keyword">return</span> localNames;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Built-in-Java-Annotations"><a href="#Built-in-Java-Annotations" class="headerlink" title="Built-in Java Annotations"></a>Built-in Java Annotations</h3><p>Java有三类compiler instructions的注解，分别是：</p>
<ul>
<li>@Deprecated</li>
<li>@Override</li>
<li>@SupressWarnings</li>
</ul>
<h4 id="Deprecated"><a href="#Deprecated" class="headerlink" title="@Deprecated"></a>@Deprecated</h4><p>@Deprecated注解用来表明class method 或者field 被弃用，不应该再被使用，如果代码中使用这些被弃用的类、方法、或域则编译器会给出warning。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Deprecated</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span>&#123;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在使用@Deprecated注解的时候，最好和Java注释一起使用，说明被弃用的原因，以及替代的新类、方法或域。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Deprecated</span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">  <span class="doctag">@deprecated</span> Use MyNewComponent instead.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> &#123;</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Override"><a href="#Override" class="headerlink" title="@Override"></a>@Override</h4><p>@Override在方法上使用，用来表示对父类同名方法的重写覆盖。如果方法与父类中找不到同名方法，使用@Override编译器会给出错误。</p>
<p>在覆盖父类的方法时，@Override注解不是必须的，但建议加上，防止父类修改同名方法，子类未加@Override注解发现不了。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MySuperClass</span> </span>&#123;</div><div class="line"></div><div class="line">    public void doTheThing() &#123;</div><div class="line">        <span class="type">System</span>.out.println(<span class="string">"Do the thing"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MySubClass</span> <span class="keyword">extends</span> <span class="title">MySuperClass</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    public void doTheThing() &#123;</div><div class="line">        <span class="type">System</span>.out.println(<span class="string">"Do it differently"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="SuppressWarnings"><a href="#SuppressWarnings" class="headerlink" title="@SuppressWarnings"></a>@SuppressWarnings</h4><p>@SuppressWarnings可以略过编译器的警告。<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SuppressWarnings</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">methodWithWarning</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Creating-Your-Own-Annotations"><a href="#Creating-Your-Own-Annotations" class="headerlink" title="Creating Your Own Annotations"></a>Creating Your Own Annotations</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">interface</span> <span class="title">MyAnnotation</span> &#123;</div><div class="line"></div><div class="line">    <span class="function">String   <span class="title">value</span>(<span class="params"></span>)</span>;</div><div class="line"></div><div class="line">    <span class="function">String   <span class="title">name</span>(<span class="params"></span>)</span>;</div><div class="line">    <span class="function"><span class="keyword">int</span>      <span class="title">age</span>(<span class="params"></span>)</span>;</div><div class="line">    <span class="function">String[] <span class="title">newNames</span>(<span class="params"></span>)</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面定义了一个包含四个元素的注解，关键字@interface向编译器表明这是注解的定义。<br>注解中的元素由数据类型和名字组成，类似interface接口中的抽象方法。但数据类型只能是基本数据类型或者是基本数据类型的数组，而不能是复杂对象。</p>
<p>使用上面注解的例子如下：<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@MyAnnotation(</div><div class="line">    value=<span class="string">"123"</span>,</div><div class="line">    name=<span class="string">"Jakob"</span>,</div><div class="line">    age=<span class="number">37</span>,</div><div class="line">    <span class="keyword">new</span><span class="type">Names</span>=&#123;<span class="string">"Jenkov"</span>, <span class="string">"Peterson"</span>&#125;</div><div class="line">)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Element-Default-Values"><a href="#Element-Default-Values" class="headerlink" title="Element Default Values"></a>Element Default Values</h4><p>定义注解时，可以为其中的元素指定默认值，这样在添加注解时可以省略具有默认值的元素。<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@<span class="class"><span class="keyword">interface</span> <span class="title">MyAnnotation</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">String</span>   value() <span class="keyword">default</span> <span class="string">""</span>;</div><div class="line"></div><div class="line">    <span class="keyword">String</span>   name();</div><div class="line">    int      age();</div><div class="line">    <span class="keyword">String</span>[] <span class="keyword">new</span><span class="type">Names</span>();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>value元素指定了默认值，所以可以不用给它赋值。<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@MyAnnotation(</div><div class="line">    name=<span class="string">"Jakob"</span>,</div><div class="line">    age=<span class="number">37</span>,</div><div class="line">    <span class="keyword">new</span><span class="type">Names</span>=&#123;<span class="string">"Jenkov"</span>, <span class="string">"Peterson"</span>&#125;</div><div class="line">)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a>@Retention</h4><p>定义该注解的生命周期，表示在什么级别保留此信息。</p>
<ul>
<li><p>RetentionPolicy.SOURCE – 在编译阶段丢弃。这些注解在编译结束之后就不再有任何意义，所以它们不会写入字节码。@Override, @SuppressWarnings都属于这类注解。</p>
</li>
<li><p>RetentionPolicy.CLASS – 在类加载的时候丢弃。在字节码文件的处理中有用。注解默认使用这种方式。（默认值）</p>
</li>
<li><p>RetentionPolicy.RUNTIME– 始终不会丢弃，运行期也保留该注解，因此可以使用反射机制读取该注解的信息。我们自定义的注解通常使用这种方式。</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.annotation</span><span class="selector-class">.Retention</span>;</div><div class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.annotation</span><span class="selector-class">.RetentionPolicy</span>;</div><div class="line"></div><div class="line">@<span class="keyword">Retention</span>(<span class="keyword">RetentionPolicy</span>.<span class="keyword">RUNTIME</span>)</div><div class="line"></div><div class="line">@<span class="keyword">interface</span> MyAnnotation &#123;</div><div class="line"></div><div class="line">    <span class="selector-tag">String</span>   <span class="selector-tag">value</span>() <span class="selector-tag">default</span> "";</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h4><p> 表示该注解用于什么地方。如果不明确指出，该注解可以放在任何地方。</p>
<ul>
<li>ElementType.TYPE:用于描述类、接口或enum声明 注解</li>
<li>ElementType.FIELD:用于描述实例变量</li>
<li>ElementType.METHOD:方法声明</li>
<li>ElementType.PARAMETER:参数声明</li>
<li>ElementType.CONSTRUCTOR:构造器的声明</li>
<li>ElementType.LOCAL_VARIABLE:局部变量声明</li>
<li>ElementType.ANNOTATION_TYPE 另一个注释(ANNOTATION_TYPE目标意味着注释只能用于注释其他注释。像@Target和@Retention注释一样。)</li>
<li>ElementType.PACKAGE 用于记录java文件的package信息。</li>
</ul>
<hr>
<pre><code>import java.lang.annotation.ElementType;
import java.lang.annotation.Target;

@Target({ElementType.METHOD})
public @interface MyAnnotation {

      String value();
}
</code></pre><h4 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h4><p>允许子类继承父类中的注解</p>
<pre><code>java.lang.annotation.Inherited

@Inherited
public @interface MyAnnotation{

}
</code></pre><hr>
<pre><code>@MyAnnotation
public class MySuperClass {...}
</code></pre><hr>
<pre><code>public class MySubClass extends MySuperClass {...}
</code></pre><p> MySubClass可以继承MySuperClass的注解，因为声明了@Inherited</p>
<h4 id="Documented"><a href="#Documented" class="headerlink" title="@Documented"></a>@Documented</h4><p>一个简单的Annotations标记注解，表示是否将注解信息添加在java文档中。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta"><span class="meta-keyword">import</span> java.lang.annotation.Documented;</span></div><div class="line"></div><div class="line">@Documented</div><div class="line"><span class="keyword">public</span> @<span class="class"><span class="keyword">interface</span> <span class="title">MyAnnotation</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MyAnnotation</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySuperClass</span> &#123;</span> ... &#125;</div></pre></td></tr></table></figure>
<p>当为MySuperClass类生成JavaDoc时， @MyAnnotation注解将会被包含进JavaDoc。</p>
<p><strong><em> Java注解的例子和注解处理器等内容将在新的文章中讲解 (待补充)</em></strong></p>
<h2 id="Class-Annotations"><a href="#Class-Annotations" class="headerlink" title="Class Annotations"></a>Class Annotations</h2><p> 使用反射可以在运行时得到类、方法、域变量的注解。</p>
<p> 类：<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Class aClass = TheClass.<span class="keyword">class</span>;</div><div class="line">Annotation[] annotations = aClass.getAnnotations();</div><div class="line"></div><div class="line"><span class="keyword">for</span>(Annotation <span class="keyword">annotation</span> : annotations)&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">annotation</span> instanceof MyAnnotation)&#123;</div><div class="line">        MyAnnotation myAnnotation = (MyAnnotation) <span class="keyword">annotation</span>;</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"name: "</span> + myAnnotation.name());</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"value: "</span> + myAnnotation.<span class="keyword">value</span>());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>已知注解的名字还可以直接得到注解。<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Class aClass = TheClass.<span class="keyword">class</span>;</div><div class="line">Annotation <span class="keyword">annotation</span> = aClass.getAnnotation(MyAnnotation.<span class="keyword">class</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(<span class="keyword">annotation</span> instanceof MyAnnotation)&#123;</div><div class="line">    MyAnnotation myAnnotation = (MyAnnotation) <span class="keyword">annotation</span>;</div><div class="line">    System.<span class="keyword">out</span>.println(<span class="string">"name: "</span> + myAnnotation.name());</div><div class="line">    System.<span class="keyword">out</span>.println(<span class="string">"value: "</span> + myAnnotation.<span class="keyword">value</span>());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Method-Annotations"><a href="#Method-Annotations" class="headerlink" title="Method Annotations"></a>Method Annotations</h2><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TheClass</span> &#123;</div><div class="line">  @MyAnnotation(name=<span class="string">"someName"</span>,  <span class="keyword">value</span> = <span class="string">"Hello World"</span>)</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> = ... //<span class="title">obtain</span> <span class="title">method</span> <span class="title">object</span></span></div><div class="line"><span class="function"><span class="title">Annotation</span>[] <span class="title">annotations</span> = <span class="title">method</span>.<span class="title">getDeclaredAnnotations</span><span class="params">()</span>;</span></div><div class="line"></div><div class="line"><span class="keyword">for</span>(Annotation annotation : annotations)<span class="comment">&#123;</span></div><div class="line"><span class="comment">    if(annotation instanceof MyAnnotation)&#123;</span></div><div class="line"><span class="comment">        MyAnnotation myAnnotation = (MyAnnotation) annotation;</span></div><div class="line"><span class="comment">        System.out.println("name: " + myAnnotation.name());</span></div><div class="line"><span class="comment">        System.out.println("value: " + myAnnotation.value());</span></div><div class="line"><span class="comment">    &#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>已知注解的名字：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> = ... // <span class="title">obtain</span> <span class="title">method</span> <span class="title">object</span></span></div><div class="line"><span class="function"><span class="title">Annotation</span> <span class="title">annotation</span> = <span class="title">method</span>.<span class="title">getAnnotation</span><span class="params">(MyAnnotation.<span class="keyword">class</span>)</span>;</span></div><div class="line"></div><div class="line"><span class="keyword">if</span>(annotation instanceof MyAnnotation)<span class="comment">&#123;</span></div><div class="line"><span class="comment">    MyAnnotation myAnnotation = (MyAnnotation) annotation;</span></div><div class="line"><span class="comment">    System.out.println("name: " + myAnnotation.name());</span></div><div class="line"><span class="comment">    System.out.println("value: " + myAnnotation.value());</span></div><div class="line"><span class="comment">&#125;</span></div></pre></td></tr></table></figure></p>
<h2 id="Parameter-Annotations"><a href="#Parameter-Annotations" class="headerlink" title="Parameter Annotations"></a>Parameter Annotations</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">public</span> <span class="selector-tag">class</span> <span class="selector-tag">TheClass</span> &#123;</div><div class="line">  <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">doSomethingElse</span>(</div><div class="line">        <span class="variable">@MyAnnotation</span>(name=<span class="string">"aName"</span>, value=<span class="string">"aValue"</span>) String parameter)&#123;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> = ... //<span class="title">obtain</span> <span class="title">method</span> <span class="title">object</span></span></div><div class="line"><span class="function"><span class="title">Annotation</span>[][] <span class="title">parameterAnnotations</span> = <span class="title">method</span>.<span class="title">getParameterAnnotations</span><span class="params">()</span>;</span></div><div class="line"><span class="keyword">Class</span>[] parameterTypes = <span class="function"><span class="keyword">method</span>.<span class="title">getParameterTypes</span><span class="params">()</span>;</span></div><div class="line"></div><div class="line">int i=<span class="number">0</span>;</div><div class="line"><span class="keyword">for</span>(Annotation[] annotations : parameterAnnotations)<span class="comment">&#123;</span></div><div class="line"><span class="comment">  Class parameterType = parameterTypes[i++];</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">  for(Annotation annotation : annotations)&#123;</span></div><div class="line"><span class="comment">    if(annotation instanceof MyAnnotation)&#123;</span></div><div class="line"><span class="comment">        MyAnnotation myAnnotation = (MyAnnotation) annotation;</span></div><div class="line"><span class="comment">        System.out.println("param: " + parameterType.getName());</span></div><div class="line"><span class="comment">        System.out.println("name : " + myAnnotation.name());</span></div><div class="line"><span class="comment">        System.out.println("value: " + myAnnotation.value());</span></div><div class="line"><span class="comment">    &#125;</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Method.getParameterAnnotations()返回一个二维Annotation数组，每个参数对应一个注解数组，所以返回二维Annotation数组。</p>
<h2 id="Field-Annotations"><a href="#Field-Annotations" class="headerlink" title="Field Annotations"></a>Field Annotations</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TheClass</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@MyAnnotation(name=<span class="meta-string">"someName"</span>,  value = <span class="meta-string">"Hello World"</span>)</span></div><div class="line">  <span class="keyword">public</span> String myField = <span class="literal">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Field field = ... <span class="comment">//obtain field object</span></div><div class="line">Annotation[] annotations = field.getDeclaredAnnotations();</div><div class="line"></div><div class="line"><span class="keyword">for</span>(Annotation <span class="keyword">annotation</span> : annotations)&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">annotation</span> instanceof MyAnnotation)&#123;</div><div class="line">        MyAnnotation myAnnotation = (MyAnnotation) <span class="keyword">annotation</span>;</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"name: "</span> + myAnnotation.name());</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"value: "</span> + myAnnotation.<span class="keyword">value</span>());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>已知注解的名字：</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Field field = ... <span class="comment">// obtain method object</span></div><div class="line">Annotation <span class="keyword">annotation</span> = field.getAnnotation(MyAnnotation.<span class="keyword">class</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(<span class="keyword">annotation</span> instanceof MyAnnotation)&#123;</div><div class="line">    MyAnnotation myAnnotation = (MyAnnotation) <span class="keyword">annotation</span>;</div><div class="line">    System.<span class="keyword">out</span>.println(<span class="string">"name: "</span> + myAnnotation.name());</div><div class="line">    System.<span class="keyword">out</span>.println(<span class="string">"value: "</span> + myAnnotation.<span class="keyword">value</span>());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>例子：</p>
<p>注解的定义：</p>
<p><img src="/blog/images/MyAnnotation.png" alt="Myannotation"></p>
<p>测试类：</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.iaihe.Annotations;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.<span class="keyword">annotation</span>.Annotation;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Field;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by zlshi on 17-11-23.</span></div><div class="line"><span class="comment"> */</span></div><div class="line">@MyAnnotation(name = <span class="string">"class"</span>,<span class="keyword">value</span>=<span class="string">"class annotation test"</span>)</div><div class="line">public <span class="keyword">class</span> TheClass &#123;</div><div class="line">    @MyAnnotation(name=<span class="string">"field"</span>,<span class="keyword">value</span>=<span class="string">"field annotation test"</span>)</div><div class="line">    public String myField = null;</div><div class="line">    @MyAnnotation(name=<span class="string">"method"</span>,<span class="keyword">value</span>=<span class="string">"method annotation test"</span>)</div><div class="line">    public <span class="keyword">void</span> doSomething()&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    public static <span class="keyword">void</span> doSomethingElse(</div><div class="line">            @MyAnnotation(name=<span class="string">"parameter"</span>,<span class="keyword">value</span>=<span class="string">"parameter annotation test"</span>) String parameter)&#123;</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"somethinElse: "</span>+parameter);</div><div class="line">    &#125;</div><div class="line">    public static <span class="keyword">void</span> main(String[] args) <span class="meta">throws</span> Exception&#123;</div><div class="line">        Class aClass = TheClass.<span class="keyword">class</span>;</div><div class="line">        <span class="comment">//Class Annotations</span></div><div class="line">        Annotation[] annotationss = aClass.getAnnotations();</div><div class="line">        <span class="keyword">for</span>(Annotation <span class="keyword">annotation</span> : annotationss)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">annotation</span> instanceof  MyAnnotation)&#123;</div><div class="line">                MyAnnotation myAnnotation = (MyAnnotation)<span class="keyword">annotation</span>;</div><div class="line">                System.<span class="keyword">out</span>.println(<span class="string">"name: "</span>+myAnnotation.name());</div><div class="line">                System.<span class="keyword">out</span>.println(<span class="string">"value: "</span>+myAnnotation.<span class="keyword">value</span>());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"=============================="</span>);</div><div class="line">        <span class="comment">//Class Annotations</span></div><div class="line">        Annotation <span class="keyword">annotation</span> = aClass.getAnnotation(MyAnnotation.<span class="keyword">class</span>);</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">annotation</span> instanceof  MyAnnotation)</div><div class="line">        &#123;</div><div class="line">            MyAnnotation myAnnotation = (MyAnnotation)<span class="keyword">annotation</span>;</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">"name: "</span>+myAnnotation.name());</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">"value: "</span>+myAnnotation.<span class="keyword">value</span>());</div><div class="line">        &#125;</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"=============================="</span>);</div><div class="line">        <span class="comment">//Method Annotations</span></div><div class="line">        Method method = aClass.getDeclaredMethod(<span class="string">"doSomething"</span>);</div><div class="line">        Annotation <span class="keyword">annotation</span><span class="number">1</span> = method.getAnnotation(MyAnnotation.<span class="keyword">class</span>);</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">annotation</span><span class="number">1</span> instanceof MyAnnotation)</div><div class="line">        &#123;</div><div class="line">            MyAnnotation myAnnotation = (MyAnnotation)<span class="keyword">annotation</span><span class="number">1</span>;</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">"name: "</span>+myAnnotation.name());</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">"value: "</span>+myAnnotation.<span class="keyword">value</span>());</div><div class="line">        &#125;</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"=============================="</span>);</div><div class="line">        <span class="comment">//Parameter Annotations</span></div><div class="line">        Method method<span class="number">1</span> = aClass.getDeclaredMethod(<span class="string">"doSomethingElse"</span>, String.<span class="keyword">class</span>);</div><div class="line">        Annotation[][] parameterAnnotations = method<span class="number">1</span>.getParameterAnnotations();</div><div class="line">        Class[] parameterTypes = method<span class="number">1</span>.getParameterTypes();</div><div class="line">        int i = <span class="number">0</span>;</div><div class="line">        method<span class="number">1</span>.invoke(null,<span class="string">"Test somethingElse method"</span>);</div><div class="line">        <span class="keyword">for</span>(Annotation[] annotations:parameterAnnotations)</div><div class="line">        &#123;</div><div class="line">            Class parameterType = parameterTypes[i++];</div><div class="line">            <span class="keyword">for</span>(Annotation anno:annotations)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span>(anno instanceof MyAnnotation)</div><div class="line">                &#123;</div><div class="line">                    MyAnnotation myAnnotation = (MyAnnotation)anno;</div><div class="line">                    System.<span class="keyword">out</span>.println(<span class="string">"param: "</span>+parameterType.getName());</div><div class="line">                    System.<span class="keyword">out</span>.println(<span class="string">"name: "</span>+myAnnotation.name());</div><div class="line">                    System.<span class="keyword">out</span>.println(<span class="string">"value: "</span>+myAnnotation.<span class="keyword">value</span>());</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"=============================="</span>);</div><div class="line">        <span class="comment">//Field Annotations</span></div><div class="line">        Field field = aClass.getDeclaredField(<span class="string">"myField"</span>);</div><div class="line">        Annotation <span class="keyword">annotation</span><span class="number">2</span> = field.getAnnotation(MyAnnotation.<span class="keyword">class</span>);</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">annotation</span><span class="number">2</span> instanceof  MyAnnotation)</div><div class="line">        &#123;</div><div class="line">            MyAnnotation myAnnotation = (MyAnnotation)<span class="keyword">annotation</span><span class="number">2</span>;</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">"name: "</span>+myAnnotation.name());</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">"value: "</span>+myAnnotation.<span class="keyword">value</span>());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="/blog/images/TheClassResult.png" alt="reuslt"></p>
<h1 id="Generics"><a href="#Generics" class="headerlink" title="Generics"></a>Generics</h1><h2 id="The-Generics-Reflection-Rule-of-Thumb"><a href="#The-Generics-Reflection-Rule-of-Thumb" class="headerlink" title="The Generics Reflection Rule of Thumb"></a>The Generics Reflection Rule of Thumb</h2><p>使用Java泛型通常属于以下两种情况之一：</p>
<ol>
<li>Declaring a class/interface as being parameterizable.（声明类/接口是可参数化的）</li>
<li>Using a parameterizable class.（使用可参数化的类）</li>
</ol>
<h2 id="Generic-Method-Return-Types"><a href="#Generic-Method-Return-Types" class="headerlink" title="Generic Method Return Types"></a>Generic Method Return Types</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">protected</span> List&lt;String&gt; stringList = ...;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> List&lt;String&gt; getStringList()&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.stringList;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以获得getStringList()方法的返回值类型。<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> = <span class="title">MyClass</span>.<span class="title">class</span>.<span class="title">getMethod</span><span class="params">("getStringList", null)</span>;</span></div><div class="line"></div><div class="line"><span class="keyword">Type</span> returnType = <span class="function"><span class="keyword">method</span>.<span class="title">getGenericReturnType</span><span class="params">()</span>;</span></div><div class="line"></div><div class="line"><span class="keyword">if</span>(returnType instanceof ParameterizedType)<span class="comment">&#123;</span></div><div class="line"><span class="comment">    ParameterizedType type = (ParameterizedType) returnType;</span></div><div class="line"><span class="comment">    Type[] typeArguments = type.getActualTypeArguments();</span></div><div class="line"><span class="comment">    for(Type typeArgument : typeArguments)&#123;</span></div><div class="line"><span class="comment">        Class typeArgClass = (Class) typeArgument;</span></div><div class="line"><span class="comment">        System.out.println("typeArgClass = " + typeArgClass);</span></div><div class="line"><span class="comment">    &#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>方法的返回值类型为泛型时，需要使用Method.getGenericReturnType()方法来获得返回类型。</p>
<p>例子：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.iaihe.Generics;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Type;</div><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by zlshi on 17-11-23.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> MyClass &#123;</div><div class="line">    <span class="keyword">protected</span> List&lt;String&gt; stringList = Arrays.<span class="keyword">asList</span>(<span class="string">"test"</span>);</div><div class="line">    <span class="keyword">public</span> List&lt;String&gt; getStringList()</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.stringList;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> List&lt;?&gt; test()</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> testUnGeneric()</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args)<span class="keyword">throws</span> Exception &#123;</div><div class="line">        Method method1 = MyClass.<span class="keyword">class</span>.getDeclaredMethod(<span class="string">"getStringList"</span>);</div><div class="line">        Type type1 = method1.getReturnType(); <span class="comment">//获取不到List里的String类型</span></div><div class="line">        System.out.<span class="keyword">println</span>(type1);</div><div class="line">        type1 = method1.getGenericReturnType();</div><div class="line">        System.out.<span class="keyword">println</span>(type1);</div><div class="line">        <span class="keyword">if</span>(type1 <span class="keyword">instanceof</span> ParameterizedType)&#123;</div><div class="line">            ParameterizedType type = (ParameterizedType) type1;</div><div class="line">            Type[] typeArguments = type.getActualTypeArguments();</div><div class="line">            <span class="keyword">for</span>(Type typeArgument : typeArguments)&#123;</div><div class="line">                <span class="keyword">Class</span> typeArgClass = (<span class="keyword">Class</span>) typeArgument;</div><div class="line">                System.out.<span class="keyword">println</span>(<span class="string">"typeArgClass = "</span> + typeArgClass);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"==================================="</span>);</div><div class="line">        Method method2 = MyClass.<span class="keyword">class</span>.getMethod(<span class="string">"test"</span>,<span class="keyword">null</span>);</div><div class="line">        Type type2 = method2.getGenericReturnType();</div><div class="line">        System.out.<span class="keyword">println</span>(type2);</div><div class="line">        <span class="keyword">if</span>(type2 <span class="keyword">instanceof</span> ParameterizedType)&#123;</div><div class="line">            ParameterizedType type = (ParameterizedType) type2;</div><div class="line">            Type[] typeArguments = type.getActualTypeArguments();</div><div class="line">            <span class="keyword">for</span>(Type typeArgument : typeArguments)&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    <span class="keyword">Class</span> typeArgClass = (<span class="keyword">Class</span>) typeArgument; <span class="comment">//抛出异常</span></div><div class="line">                    System.out.<span class="keyword">println</span>(<span class="string">"typeArgClass = "</span> + typeArgClass);</div><div class="line">                &#125;<span class="keyword">catch</span>(Exception ex)</div><div class="line">                &#123;</div><div class="line">                    System.out.<span class="keyword">println</span>(<span class="string">"ExceptionInfo: "</span>+ex.getMessage());</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"==================================="</span>);</div><div class="line">        Method method3 = MyClass.<span class="keyword">class</span>.getMethod(<span class="string">"testUnGeneric"</span>,<span class="keyword">null</span>);</div><div class="line">        Type type3 = method3.getReturnType(); <span class="comment">//getReturnType()就可以返回类型</span></div><div class="line">        System.out.<span class="keyword">println</span>(type3); <span class="comment">//输出int</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<p><img src="/blog/images/GenericReturnTypeOfMyClass.png" alt="Generic returnType Method"></p>
<h2 id="Generic-Method-Parameter-Types"><a href="#Generic-Method-Parameter-Types" class="headerlink" title="Generic Method Parameter Types"></a>Generic Method Parameter Types</h2><p>也可以通过反射得到方法中的泛型参数<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> class MyClass &#123;</div><div class="line">  <span class="keyword">protected</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; stringList = <span class="params">...</span>;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="literal">void</span> setStringList(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; <span class="built_in">list</span>)&#123;</div><div class="line">    this.stringList = <span class="built_in">list</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">method</span> = <span class="title">Myclass</span>.<span class="title">class</span>.<span class="title">getMethod</span><span class="params">("setStringList", List.<span class="keyword">class</span>)</span>;</span></div></pre></td></tr></table></figure>
<p><strong>Type[] genericParameterTypes = method.getGenericParameterTypes();</strong><br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">Type</span> <span class="type">genericParameterType </span>: genericParameterTypes)&#123;</div><div class="line">    <span class="keyword">if</span>(genericParameterType instanceof ParameterizedType)&#123;</div><div class="line">        ParameterizedType aType = (ParameterizedType) genericParameterType;</div><div class="line">        <span class="keyword">Type</span>[] parameterArgTypes = aType.getActualTypeArguments();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">Type</span> <span class="type">parameterArgType </span>: parameterArgTypes)&#123;</div><div class="line">            Class parameterArgClass = (Class) parameterArgType;</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">"parameterArgClass = "</span> + parameterArgClass);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Generic-Field-Types"><a href="#Generic-Field-Types" class="headerlink" title="Generic Field Types"></a>Generic Field Types</h2><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> List&lt;<span class="keyword">String</span>&gt; stringList = ...;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Field field = MyClass.class.getField(<span class="string">"stringList"</span>);</div><div class="line"></div><div class="line">Type genericFieldType = field.getGenericType();</div><div class="line"></div><div class="line"><span class="keyword">if</span>(genericFieldType instanceof ParameterizedType)&#123;</div><div class="line">    ParameterizedType aType = (ParameterizedType) genericFieldType;</div><div class="line">    Type[] fieldArgTypes = aType.getActualTypeArguments();</div><div class="line">    <span class="keyword">for</span>(Type fieldArgType : fieldArgTypes)&#123;</div><div class="line">        Class fieldArgClass = (Class) fieldArgType;</div><div class="line">        System.out.println(<span class="string">"fieldArgClass = "</span> + fieldArgClass);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h1><h2 id="java-lang-reflect-Array"><a href="#java-lang-reflect-Array" class="headerlink" title="java.lang.reflect.Array"></a>java.lang.reflect.Array</h2><p>使用java.lang.reflect.Array类处理数组的反射。</p>
<h2 id="Creating-Arrays"><a href="#Creating-Arrays" class="headerlink" title="Creating Arrays"></a>Creating Arrays</h2><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">int</span>[] intArray = (<span class="built_in">int</span>[]) <span class="built_in">Array</span>.newInstance(<span class="built_in">int</span>.<span class="keyword">class</span>, <span class="number">3</span>);</div></pre></td></tr></table></figure>
<p>第一个参数为数组的类型，第二个参数为数组的大小。</p>
<h2 id="Accessing-Arrays"><a href="#Accessing-Arrays" class="headerlink" title="Accessing Arrays"></a>Accessing Arrays</h2><p>通过Array.get()和Array.set()方法访问数组。<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">int</span>[] intArray = (<span class="built_in">int</span>[]) <span class="keyword">Array</span>.newInstance(<span class="built_in">int</span>.class, <span class="number">3</span>);</div><div class="line"></div><div class="line"><span class="keyword">Array</span>.<span class="built_in">set</span>(intArray, <span class="number">0</span>, <span class="number">123</span>);</div><div class="line"><span class="keyword">Array</span>.<span class="built_in">set</span>(intArray, <span class="number">1</span>, <span class="number">456</span>);</div><div class="line"><span class="keyword">Array</span>.<span class="built_in">set</span>(intArray, <span class="number">2</span>, <span class="number">789</span>);</div><div class="line"></div><div class="line">System.out.<span class="built_in">println</span>(<span class="string">"intArray[0] = "</span> + <span class="keyword">Array</span>.<span class="built_in">get</span>(intArray, <span class="number">0</span>));</div><div class="line">System.out.<span class="built_in">println</span>(<span class="string">"intArray[1] = "</span> + <span class="keyword">Array</span>.<span class="built_in">get</span>(intArray, <span class="number">1</span>));</div><div class="line">System.out.<span class="built_in">println</span>(<span class="string">"intArray[2] = "</span> + <span class="keyword">Array</span>.<span class="built_in">get</span>(intArray, <span class="number">2</span>));</div></pre></td></tr></table></figure></p>
<p>上面的代码会打印：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">intArray[0]</span> = <span class="number">123</span></div><div class="line"><span class="attr">intArray[1]</span> = <span class="number">456</span></div><div class="line"><span class="attr">intArray[2]</span> = <span class="number">789</span></div></pre></td></tr></table></figure></p>
<h2 id="Obtaining-the-Class-Object-of-an-Array"><a href="#Obtaining-the-Class-Object-of-an-Array" class="headerlink" title="Obtaining the Class Object of an Array"></a>Obtaining the Class Object of an Array</h2><p>获取数组的类对象</p>
<p> 对于原始类型：<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> intArray = <span class="keyword">Class</span>.forName(<span class="string">"[I"</span>);</div></pre></td></tr></table></figure></p>
<p>JVM使用I来表示int类型，<code>[</code>表示是一个int数组。其它primitive类型类似。</p>
<p>对于对象：<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> stringArrayClass = <span class="keyword">Class</span>.forName(<span class="string">"[Ljava.lang.String;"</span>);</div></pre></td></tr></table></figure></p>
<p><code>[L</code>表示是对象数组。</p>
<p>不能使用Class.forName()来获得原始类型的类对象，会抛出ClassNotFoundException异常。</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> intClass1 = <span class="keyword">Class</span>.forName(<span class="string">"I"</span>);</div><div class="line"><span class="keyword">Class</span> intClass2 = <span class="keyword">Class</span>.forName(<span class="string">"int"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">Class</span> getClass(String className)&#123;</div><div class="line">  <span class="keyword">if</span>(<span class="string">"int"</span> .equals(className)) <span class="keyword">return</span> <span class="keyword">int</span> .<span class="keyword">class</span>;</div><div class="line">  <span class="keyword">if</span>(<span class="string">"long"</span>.equals(className)) <span class="keyword">return</span> <span class="keyword">long</span>.<span class="keyword">class</span>;</div><div class="line">  ...</div><div class="line">  <span class="keyword">return</span> <span class="keyword">Class</span>.forName(className);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//得到数组中元素的类型</span></div><div class="line"><span class="keyword">Class</span> theClass = getClass(theClassName);</div><div class="line"></div><div class="line"><span class="comment">//得到ltheClass构成的数组对象的类型</span></div><div class="line"><span class="keyword">Class</span> stringArrayClass = <span class="keyword">Array</span>.newInstance(theClass, <span class="number">0</span>).getClass();</div></pre></td></tr></table></figure>
<p>检查是否为数组类型：<br><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> stringArrayClass = <span class="built_in">Array</span>.newInstance(<span class="built_in">String</span>.<span class="keyword">class</span>, <span class="number">0</span>).getClass();</div><div class="line">System.out.println(<span class="string">"is array: "</span> + stringArrayClass.<span class="built_in">isArray</span>());</div></pre></td></tr></table></figure></p>
<h2 id="Obtaining-the-Component-Type-of-an-Array"><a href="#Obtaining-the-Component-Type-of-an-Array" class="headerlink" title="Obtaining the Component Type of an Array"></a>Obtaining the Component Type of an Array</h2><p>使用Class.getComponentType()获得数组中元素的类型：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">String[] </span><span class="keyword">strings </span>= new <span class="keyword">String[3];</span></div><div class="line"><span class="keyword">Class </span><span class="keyword">stringArrayClass </span>= <span class="keyword">strings.getClass();</span></div><div class="line"><span class="keyword">Class </span><span class="keyword">stringArrayComponentType </span>= <span class="keyword">stringArrayClass.getComponentType();</span></div><div class="line"><span class="keyword">System.out.println(stringArrayComponentType); </span>// will print java.lang.<span class="keyword">String</span></div></pre></td></tr></table></figure></p>
<h1 id="Dynamic-Proxies"><a href="#Dynamic-Proxies" class="headerlink" title="Dynamic Proxies"></a>Dynamic Proxies</h1><p>使用java.lang.reflect.Proxy可以在运行时创建接口的动态实现。</p>
<h2 id="Creating-Proxies"><a href="#Creating-Proxies" class="headerlink" title="Creating Proxies"></a>Creating Proxies</h2><p>使用Proxy.newProxyInstance()方法来创建动态代理，方法需要如下三个参数：</p>
<ol>
<li>类加载器ClassLoader用来装载动态代理类。</li>
<li>要实现的接口对象数组。</li>
<li>InvocationHandler转发处理代理的方法。</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">InvocationHandler handler = new MyInvocationHandler();</div><div class="line">MyInterface<span class="built_in"> proxy </span>= (MyInterface) Proxy.newProxyInstance(</div><div class="line">                            MyInterface.class.getClassLoader(),</div><div class="line">                            new Class[] &#123; MyInterface.class &#125;,</div><div class="line">                            handler);</div></pre></td></tr></table></figure>
<h2 id="InvocationHandler’s"><a href="#InvocationHandler’s" class="headerlink" title="InvocationHandler’s"></a>InvocationHandler’s</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public<span class="built_in"> interface </span>InvocationHandler&#123;</div><div class="line">  Object invoke(Object proxy, Method method, Object[] args)</div><div class="line">         throws Throwable;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></div><div class="line"><span class="function">  <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">    <span class="comment">//do something "dynamic"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>invoke()中的proxy对象为实现接口的动态代理对象。<br>Method对象表示接口中方法的动态代理实现，可以使用反射得到方法名，参数列表以及返回类型。<br>Object[] args数组表示方法的具体参数对象。</p>
<h2 id="Known-Use-Cases"><a href="#Known-Use-Cases" class="headerlink" title="Known Use Cases"></a>Known Use Cases</h2><p>动态代理的使用情形：</p>
<ul>
<li>Database Connection and Transaction Management</li>
<li>Dynamic Mock Objects for Unit Testing</li>
<li>Adaptation of DI Container to Custom Factory Interfaces</li>
<li>AOP-like Method Interception</li>
</ul>
<h1 id="Dynamic-Class-Loading-and-Reloading"><a href="#Dynamic-Class-Loading-and-Reloading" class="headerlink" title="Dynamic Class Loading and Reloading"></a>Dynamic Class Loading and Reloading</h1><h2 id="The-ClassLoader"><a href="#The-ClassLoader" class="headerlink" title="The ClassLoader"></a>The ClassLoader</h2><p>Java中类的加载由java.lang.ClassLoader的子类完成。当一个类被加载时，它所引用的所有类也被加载。这个类加载模式是递归的，直到所有需要的类都被加载。这可能不是应用程序中的所有类。未引用的类只有在引用时才加载。</p>
<h2 id="The-ClassLoader-Hierarchy"><a href="#The-ClassLoader-Hierarchy" class="headerlink" title="The ClassLoader Hierarchy"></a>The ClassLoader Hierarchy</h2><p>Java中的类加载器被组织成一个层次结构。当您创建新的标准Java ClassLoader时，您必须提供一个父类ClassLoader。如果一个ClassLoader被要求加载一个类，它会要求它的父类加载器加载它。如果父类加载器找不到该类，那么子类加载器将尝试自己加载它。</p>
<h2 id="Class-Loading"><a href="#Class-Loading" class="headerlink" title="Class Loading"></a>Class Loading</h2><p>类加载器在加载类时的步骤如下：</p>
<ol>
<li>Check if the class was already loaded.（检查类是否已经被加载）</li>
<li>If not loaded, ask parent class loader to load the class.（如果没有被加载，则请求父类加载器加载）</li>
<li>If parent class loader cannot load class, attempt to load it in this class loader.（如果父加载器不能加载，则尝试自己加载类）</li>
</ol>
<h2 id="Dynamic-Class-Loading"><a href="#Dynamic-Class-Loading" class="headerlink" title="Dynamic Class Loading"></a>Dynamic Class Loading</h2><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainClass</span> &#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>)</span>&#123;</div><div class="line"></div><div class="line">    ClassLoader classLoader = MainClass.class.getClassLoader();</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        Class aClass = classLoader.loadClass(<span class="string">"MyClass"</span>);</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"aClass.getName() = "</span> + aClass.getName());</div><div class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Dynamic-Class-Reloading"><a href="#Dynamic-Class-Reloading" class="headerlink" title="Dynamic Class Reloading"></a>Dynamic Class Reloading</h2><p>Java的内置Class加载器在加载之前总是检查一个类是否已经被加载。因此，使用Java的内置类加载器不能重新加载类。重新加载一个类，你将不得不实现你自己的ClassLoader子类。每个加载的类都需要链接。这是使用ClassLoader.resolve（）方法完成的。这个方法是final的，因此不能在你的ClassLoader子类中重写。resolve（）方法将不允许任何给定的ClassLoader实例连接两次相同的类。<br>因此，每次你想重新加载一个类，你都必须使用ClassLoader子类的一个新实例。这不是不可能的，但是在设计类重新加载时需要知道。</p>
<h2 id="Designing-your-Code-for-Class-Reloading"><a href="#Designing-your-Code-for-Class-Reloading" class="headerlink" title="Designing your Code for Class Reloading"></a>Designing your Code for Class Reloading</h2><p>如前所述，您不能使用已经加载该类的ClassLoader重载一个类。因此，您将不得不使用不同的ClassLoader实例重新加载类。加载到Java应用程序中的每个类都由其完全限定的名称（包名称+类名称）和加载它的ClassLoader实例标识。这意味着，类加载器A加载的类MyObject与载类加载器B的MyObject类不是同一个类。<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">MyObject object</span> = (MyObject)</div><div class="line">    myClassReloadingFactory.newInstance(<span class="string">"MyObject"</span>);</div></pre></td></tr></table></figure></p>
<p>如果myClassReloadingFactory对象工厂使用与上面的代码所在的类不同的类加载器重新加载MyObject类，您不能将重新装入的MyObject类的实例转换为对象变量的MyObject类型。由于两个MyObject类用不同的类加载器加载，因此即使它们具有相同的完全限定类名，它们也被视为不同的类。试图将一个类的对象转换为另一个类的引用将导致ClassCastException。</p>
<p>使用如下方式解决：</p>
<ol>
<li>Use an interface as the variable type, and just reload the implementing class.（使用一个接口作为变量类型，并重新加载实现类。）</li>
<li>Use a superclass as the variable type, and just reload a subclass.（使用超类作为变量类型，并重新加载一个子类。）</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">MyObjectInterface object</span> = (MyObjectInterface)</div><div class="line">    myClassReloadingFactory.newInstance(<span class="string">"MyObject"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">MyObjectSuperclass object</span> = (MyObjectSuperclass)</div><div class="line">    myClassReloadingFactory.newInstance(<span class="string">"MyObject"</span>);</div></pre></td></tr></table></figure>
<p>当你的类加载器被要求加载MyObject类时，它也会被要求加载MyObjectInterface类或者MyObjectSuperclass类，因为这些类是从MyObject类中引用的。您的类加载器必须将这些类的加载委托给加载包含接口或超类型变量的类的相同类加载器。</p>
<h2 id="ClassLoader-Load-Reload-Example"><a href="#ClassLoader-Load-Reload-Example" class="headerlink" title="ClassLoader Load / Reload Example"></a>ClassLoader Load / Reload Example</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>&#123;</div><div class="line"></div><div class="line">    public <span class="type">MyClassLoader</span>(<span class="type">ClassLoader</span> parent) &#123;</div><div class="line">        <span class="keyword">super</span>(parent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public <span class="type">Class</span> loadClass(<span class="type">String</span> name) <span class="keyword">throws</span> <span class="type">ClassNotFoundException</span> &#123;</div><div class="line">        <span class="keyword">if</span>(!<span class="string">"reflection.MyObject"</span>.equals(name))</div><div class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.loadClass(name);</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="type">String</span> url = <span class="string">"file:C:/data/projects/tutorials/web/WEB-INF/"</span> +</div><div class="line">                            <span class="string">"classes/reflection/MyObject.class"</span>;</div><div class="line">            <span class="type">URL</span> myUrl = <span class="keyword">new</span> <span class="type">URL</span>(url);</div><div class="line">            <span class="type">URLConnection</span> connection = myUrl.openConnection();</div><div class="line">            <span class="type">InputStream</span> input = connection.getInputStream();</div><div class="line">            <span class="type">ByteArrayOutputStream</span> buffer = <span class="keyword">new</span> <span class="type">ByteArrayOutputStream</span>();</div><div class="line">            int data = input.read();</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(data != <span class="number">-1</span>)&#123;</div><div class="line">                buffer.write(data);</div><div class="line">                data = input.read();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            input.close();</div><div class="line"></div><div class="line">            byte[] classData = buffer.toByteArray();</div><div class="line"></div><div class="line">            <span class="keyword">return</span> defineClass(<span class="string">"reflection.MyObject"</span>,</div><div class="line">                    classData, <span class="number">0</span>, classData.length);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (<span class="type">MalformedURLException</span> e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (<span class="type">IOException</span> e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>[] args) throws</div><div class="line">    ClassNotFoundException,</div><div class="line">    IllegalAccessException,</div><div class="line">    InstantiationException &#123;</div><div class="line"></div><div class="line">    ClassLoader parentClassLoader = MyClassLoader.class.getClassLoader();</div><div class="line">    MyClassLoader classLoader = <span class="keyword">new</span> <span class="type">MyClassLoader</span>(parentClassLoader);</div><div class="line">    Class myObjectClass = classLoader.loadClass(<span class="string">"reflection.MyObject"</span>);</div><div class="line"></div><div class="line">    AnInterface2       object1 =</div><div class="line">            (AnInterface2) myObjectClass.<span class="keyword">new</span><span class="type">Instance</span>();</div><div class="line"></div><div class="line">    MyObjectSuperClass object2 =</div><div class="line">            (MyObjectSuperClass) myObjectClass.<span class="keyword">new</span><span class="type">Instance</span>();</div><div class="line"></div><div class="line">    <span class="comment">//create new class loader so classes can be reloaded.</span></div><div class="line">    classLoader = <span class="keyword">new</span> <span class="type">MyClassLoader</span>(parentClassLoader);</div><div class="line">    myObjectClass = classLoader.loadClass(<span class="string">"reflection.MyObject"</span>);</div><div class="line"></div><div class="line">    object1 = (AnInterface2)       myObjectClass.<span class="keyword">new</span><span class="type">Instance</span>();</div><div class="line">    object2 = (MyObjectSuperClass) myObjectClass.<span class="keyword">new</span><span class="type">Instance</span>();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是使用类加载器加载的reflection.MyObject类。注意它是如何扩展一个超类并实现一个接口的。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> <span class="keyword">extends</span> <span class="title">MyObjectSuperClass</span> <span class="title">implements</span> <span class="title">AnInterface2</span></span>&#123;</div><div class="line">    <span class="comment">//... body of class ... override superclass methods</span></div><div class="line">    <span class="comment">//    or implement interface methods</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/blog/tags/Java-Reflection/" rel="tag"># Java Reflection</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2017/11/20/Markdown语法说明/" rel="next" title="Markdown语法说明">
                <i class="fa fa-chevron-left"></i> Markdown语法说明
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/2018/08/02/MySQL-Event/" rel="prev" title="MySQL Event">
                MySQL Event <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="uyan_frame"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/blog/images/avatar.jpg"
                alt="zlshi" />
            
              <p class="site-author-name" itemprop="name">zlshi</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/blog/archives/">
              
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/blog/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/blog/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/zlshi" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:zlshi9219@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Classes"><span class="nav-number">1.</span> <span class="nav-text">Classes</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Class-Object"><span class="nav-number">1.1.</span> <span class="nav-text">The Class Object</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Class-Name"><span class="nav-number">1.2.</span> <span class="nav-text">Class Name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Modifiers"><span class="nav-number">1.3.</span> <span class="nav-text">Modifiers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Package-Info"><span class="nav-number">1.4.</span> <span class="nav-text">Package Info</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Superclass"><span class="nav-number">1.5.</span> <span class="nav-text">Superclass</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implemented-Interfaces"><span class="nav-number">1.6.</span> <span class="nav-text">Implemented Interfaces</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Constructors"><span class="nav-number">1.7.</span> <span class="nav-text">Constructors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Methods"><span class="nav-number">1.8.</span> <span class="nav-text">Methods</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fields"><span class="nav-number">1.9.</span> <span class="nav-text">Fields</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Annotations"><span class="nav-number">1.10.</span> <span class="nav-text">Annotations</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Constructors-1"><span class="nav-number">2.</span> <span class="nav-text">Constructors</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Obtaining-Constructor-Objects"><span class="nav-number">2.1.</span> <span class="nav-text">Obtaining Constructor Objects</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Constructor-Parameters"><span class="nav-number">2.2.</span> <span class="nav-text">Constructor Parameters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Instantiating-Objects-using-Constructor-Object"><span class="nav-number">2.3.</span> <span class="nav-text">Instantiating Objects using Constructor Object</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Fields-1"><span class="nav-number">3.</span> <span class="nav-text">Fields</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Obtaining-Field-Objects"><span class="nav-number">3.1.</span> <span class="nav-text">Obtaining Field Objects</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Field-Name"><span class="nav-number">3.2.</span> <span class="nav-text">Field Name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Field-Type"><span class="nav-number">3.3.</span> <span class="nav-text">Field Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Getting-and-Setting-Field-Values"><span class="nav-number">3.4.</span> <span class="nav-text">Getting and Setting Field Values</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Methods-1"><span class="nav-number">4.</span> <span class="nav-text">Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Obtaining-Method-Objects"><span class="nav-number">4.1.</span> <span class="nav-text">Obtaining Method Objects</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Method-Parameters-and-Return-Types"><span class="nav-number">4.2.</span> <span class="nav-text">Method Parameters and Return Types</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Invoking-Methods-using-Method-Object"><span class="nav-number">4.3.</span> <span class="nav-text">Invoking Methods using Method Object</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Getters-and-Setters"><span class="nav-number">5.</span> <span class="nav-text">Getters and Setters</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Private-Fields-and-Methods"><span class="nav-number">6.</span> <span class="nav-text">Private Fields and Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Accessing-Private-Fields"><span class="nav-number">6.1.</span> <span class="nav-text">Accessing Private Fields</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Accessing-Private-Methods"><span class="nav-number">6.2.</span> <span class="nav-text">Accessing Private Methods</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Annotations-1"><span class="nav-number">7.</span> <span class="nav-text">Annotations</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-are-Java-Annotations"><span class="nav-number">7.1.</span> <span class="nav-text">What are Java Annotations?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-Annotations-Purposes"><span class="nav-number">7.1.1.</span> <span class="nav-text">Java Annotations Purposes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Annotation-Basics"><span class="nav-number">7.1.2.</span> <span class="nav-text">Annotation Basics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Annotation-Elements"><span class="nav-number">7.1.2.1.</span> <span class="nav-text">Annotation Elements</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Annotation-Placement"><span class="nav-number">7.1.3.</span> <span class="nav-text">Annotation Placement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Built-in-Java-Annotations"><span class="nav-number">7.1.4.</span> <span class="nav-text">Built-in Java Annotations</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Deprecated"><span class="nav-number">7.1.4.1.</span> <span class="nav-text">@Deprecated</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Override"><span class="nav-number">7.1.4.2.</span> <span class="nav-text">@Override</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SuppressWarnings"><span class="nav-number">7.1.4.3.</span> <span class="nav-text">@SuppressWarnings</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-Your-Own-Annotations"><span class="nav-number">7.1.5.</span> <span class="nav-text">Creating Your Own Annotations</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Element-Default-Values"><span class="nav-number">7.1.5.1.</span> <span class="nav-text">Element Default Values</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Retention"><span class="nav-number">7.1.5.2.</span> <span class="nav-text">@Retention</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Target"><span class="nav-number">7.1.5.3.</span> <span class="nav-text">@Target</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Inherited"><span class="nav-number">7.1.5.4.</span> <span class="nav-text">@Inherited</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Documented"><span class="nav-number">7.1.5.5.</span> <span class="nav-text">@Documented</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Class-Annotations"><span class="nav-number">7.2.</span> <span class="nav-text">Class Annotations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Method-Annotations"><span class="nav-number">7.3.</span> <span class="nav-text">Method Annotations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parameter-Annotations"><span class="nav-number">7.4.</span> <span class="nav-text">Parameter Annotations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Field-Annotations"><span class="nav-number">7.5.</span> <span class="nav-text">Field Annotations</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Generics"><span class="nav-number">8.</span> <span class="nav-text">Generics</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Generics-Reflection-Rule-of-Thumb"><span class="nav-number">8.1.</span> <span class="nav-text">The Generics Reflection Rule of Thumb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generic-Method-Return-Types"><span class="nav-number">8.2.</span> <span class="nav-text">Generic Method Return Types</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generic-Method-Parameter-Types"><span class="nav-number">8.3.</span> <span class="nav-text">Generic Method Parameter Types</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generic-Field-Types"><span class="nav-number">8.4.</span> <span class="nav-text">Generic Field Types</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Arrays"><span class="nav-number">9.</span> <span class="nav-text">Arrays</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#java-lang-reflect-Array"><span class="nav-number">9.1.</span> <span class="nav-text">java.lang.reflect.Array</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-Arrays"><span class="nav-number">9.2.</span> <span class="nav-text">Creating Arrays</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Accessing-Arrays"><span class="nav-number">9.3.</span> <span class="nav-text">Accessing Arrays</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Obtaining-the-Class-Object-of-an-Array"><span class="nav-number">9.4.</span> <span class="nav-text">Obtaining the Class Object of an Array</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Obtaining-the-Component-Type-of-an-Array"><span class="nav-number">9.5.</span> <span class="nav-text">Obtaining the Component Type of an Array</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dynamic-Proxies"><span class="nav-number">10.</span> <span class="nav-text">Dynamic Proxies</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-Proxies"><span class="nav-number">10.1.</span> <span class="nav-text">Creating Proxies</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#InvocationHandler’s"><span class="nav-number">10.2.</span> <span class="nav-text">InvocationHandler’s</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Known-Use-Cases"><span class="nav-number">10.3.</span> <span class="nav-text">Known Use Cases</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dynamic-Class-Loading-and-Reloading"><span class="nav-number">11.</span> <span class="nav-text">Dynamic Class Loading and Reloading</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-ClassLoader"><span class="nav-number">11.1.</span> <span class="nav-text">The ClassLoader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-ClassLoader-Hierarchy"><span class="nav-number">11.2.</span> <span class="nav-text">The ClassLoader Hierarchy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Class-Loading"><span class="nav-number">11.3.</span> <span class="nav-text">Class Loading</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dynamic-Class-Loading"><span class="nav-number">11.4.</span> <span class="nav-text">Dynamic Class Loading</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dynamic-Class-Reloading"><span class="nav-number">11.5.</span> <span class="nav-text">Dynamic Class Reloading</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Designing-your-Code-for-Class-Reloading"><span class="nav-number">11.6.</span> <span class="nav-text">Designing your Code for Class Reloading</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ClassLoader-Load-Reload-Example"><span class="nav-number">11.7.</span> <span class="nav-text">ClassLoader Load / Reload Example</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zlshi</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/blog/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/blog/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/blog/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  
    

    
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2148500"></script>
      <!-- UY END -->
    
  





  









<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/blog/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  


  

  

</body>
</html>
